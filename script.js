const _0x54417c=_0x5b21;(function(_0x323d63,_0x4c443a){const _0x21c276=_0x5b21,_0x31f96c=_0x323d63();while(!![]){try{const _0xe6bf81=parseInt(_0x21c276(0x116))/0x1+-parseInt(_0x21c276(0x14b))/0x2+parseInt(_0x21c276(0x106))/0x3+-parseInt(_0x21c276(0x11c))/0x4*(parseInt(_0x21c276(0x10c))/0x5)+-parseInt(_0x21c276(0x100))/0x6+parseInt(_0x21c276(0x137))/0x7*(parseInt(_0x21c276(0x102))/0x8)+parseInt(_0x21c276(0x159))/0x9;if(_0xe6bf81===_0x4c443a)break;else _0x31f96c['push'](_0x31f96c['shift']());}catch(_0x5233d2){_0x31f96c['push'](_0x31f96c['shift']());}}}(_0x5cd5,0x76065));const {Application,live2d:{Live2DModel,MotionPreloadStrategy},Sprite,Texture,Ticker}=PIXI,{Face,Vector:{lerp},Utils:{clamp}}=Kalidokit,urlParams=new URLSearchParams(window[_0x54417c(0x13f)][_0x54417c(0x121)]);let modelUrl=urlParams[_0x54417c(0x13c)](_0x54417c(0x105))||_0x54417c(0x131);if(console[_0x54417c(0x120)](_0x54417c(0x154),modelUrl),modelUrl[_0x54417c(0xf8)](_0x54417c(0x141))){let json=await fetch(modelUrl)['then'](_0x5b709a=>_0x5b709a[_0x54417c(0xf3)]());json[_0x54417c(0x157)]=json[_0x54417c(0x157)]||modelUrl;const selectedMotionsParam=urlParams[_0x54417c(0x13c)](_0x54417c(0x13e)),selectedMotions=selectedMotionsParam?selectedMotionsParam[_0x54417c(0xf0)](','):[];if(selectedMotions[_0x54417c(0xf4)]===0x0)json[_0x54417c(0x15f)]={};else{const newMotions={};selectedMotions[_0x54417c(0x113)](_0x35c410=>{const _0x71d6ed=_0x54417c;json[_0x71d6ed(0x15f)][_0x35c410]&&(newMotions[_0x35c410]=json[_0x71d6ed(0x15f)][_0x35c410]);}),json['motions']=newMotions;}modelUrl=json,console[_0x54417c(0x120)]('modelUrl:',modelUrl);}function _0x5b21(_0x52656c,_0x241d0f){const _0x5cd5ab=_0x5cd5();return _0x5b21=function(_0x5b21b2,_0x486651){_0x5b21b2=_0x5b21b2-0xf0;let _0x44ae93=_0x5cd5ab[_0x5b21b2];return _0x44ae93;},_0x5b21(_0x52656c,_0x241d0f);}function _0x5cd5(){const _0x1e243a=['length','screen','live2d','width','endsWith','ParamEyeLOpen','shared','#C0C0C070','canplaythrough','innerHeight','setParameterValueById','onResults','334962NcHzuc','offsetX','160aaserj','setBackgroundVideo','internalModel','modelUrl','203475xvpeKS','videoWidth','#live2d','ParamAngleX','loop','getElementById','5YGaabz','clearRect','coreModel','ParamBodyAngleZ','height','ParamEyeBallX','#ffe603','forEach','degrees','auto','546547cenoyS','addChild','focus','ParamMouthForm','ParamBodyAngleX','setBackgroundImage','3501824LpvVCE','视频播放中:','preventDefault','mouth','log','search','from','update','deltaY','setOptions','纹理创建失败或未加载完成','videoHeight','stage','Face','resource','querySelector','motionManager','hasLoaded','ParamEyeBallY','dragging','position','./models/hiyori/hiyori_pro_t10.model3.json','pointerup','addChildAt','视频加载中:','removeChild','https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/','227633sPRtVp','stabilizeBlink','data','getBoundingClientRect','getContext','get','舞台子元素数量:','selectedMotions','location','set','.json','getParameterValueById','PARAM_MOUTH_OPEN_Y','to\x20load\x20modelUrl:','addEventListener','play','solve','global','setParamFloat','anchor','330856nvSsYL','纹理创建成功:','ParamBodyAngleY','innerWidth','head','scale','start','.input_video','save','modelUrl:','getParamFloat','canvas.guides','url','ParamEyeROpen','2838492XiZzGX','undefined','add','pupil','ParamAngleZ','ParamAngleY','motions','pointerdown','NONE','source','children','baseTexture','multiFaceLandmarks','ParamMouthOpenY','mediapipe','offsetY','split','eyeBlink','function','json'];_0x5cd5=function(){return _0x1e243a;};return _0x5cd5();}let currentModel,facemesh,app,backgroundSprite;const videoElement=document['querySelector'](_0x54417c(0x152)),guideCanvas=document['querySelector'](_0x54417c(0x156));(async function(){const _0x47d14b=_0x54417c;app=new PIXI['Application']({'view':document[_0x47d14b(0x10b)](_0x47d14b(0xf6)),'autoStart':!0x0,'backgroundAlpha':0x0,'backgroundColor':0xffffff,'resizeTo':window}),console[_0x47d14b(0x120)](_0x47d14b(0x144),modelUrl),currentModel=await Live2DModel[_0x47d14b(0x122)](modelUrl,{'autoInteract':!0x1,'motionPreload':MotionPreloadStrategy[_0x47d14b(0x161)]}),console[_0x47d14b(0x120)](currentModel),currentModel[_0x47d14b(0x150)][_0x47d14b(0x140)](0.4),currentModel['interactive']=!0x0,currentModel[_0x47d14b(0x14a)][_0x47d14b(0x140)](0.5,0.5),currentModel[_0x47d14b(0x130)][_0x47d14b(0x140)](window[_0x47d14b(0x14e)]*0.5,window[_0x47d14b(0xfd)]*0.8),currentModel['on'](_0x47d14b(0x160),_0x2bf40b=>{const _0x27374d=_0x47d14b;currentModel[_0x27374d(0x101)]=_0x2bf40b['data'][_0x27374d(0x148)]['x']-currentModel[_0x27374d(0x130)]['x'],currentModel['offsetY']=_0x2bf40b[_0x27374d(0x139)]['global']['y']-currentModel[_0x27374d(0x130)]['y'],currentModel[_0x27374d(0x12f)]=!0x0;}),currentModel['on'](_0x47d14b(0x132),_0x57cf3a=>{const _0x5baa4b=_0x47d14b;currentModel[_0x5baa4b(0x12f)]=!0x1;}),currentModel['on']('pointermove',_0x20240e=>{const _0x4a42a2=_0x47d14b;currentModel[_0x4a42a2(0x12f)]&&currentModel[_0x4a42a2(0x130)][_0x4a42a2(0x140)](_0x20240e[_0x4a42a2(0x139)][_0x4a42a2(0x148)]['x']-currentModel['offsetX'],_0x20240e[_0x4a42a2(0x139)][_0x4a42a2(0x148)]['y']-currentModel[_0x4a42a2(0x168)]);}),document[_0x47d14b(0x12b)](_0x47d14b(0x108))[_0x47d14b(0x145)]('wheel',_0x5870ae=>{const _0x56ed48=_0x47d14b;_0x5870ae[_0x56ed48(0x11e)](),currentModel[_0x56ed48(0x150)]['set'](clamp(currentModel[_0x56ed48(0x150)]['x']+_0x5870ae[_0x56ed48(0x124)]*-0.001,-0.5,0xa));}),app[_0x47d14b(0x128)][_0x47d14b(0x117)](currentModel),facemesh=new FaceMesh({'locateFile':_0x20ca9c=>_0x47d14b(0x136)+_0x20ca9c}),facemesh[_0x47d14b(0x125)]({'maxNumFaces':0x1,'refineLandmarks':!0x0,'minDetectionConfidence':0.5,'minTrackingConfidence':0.5}),facemesh[_0x47d14b(0xff)](onResults),startCamera(),window['addEventListener']('clearBackgroundImage',function(){backgroundSprite&&app['stage']['removeChild'](backgroundSprite);}),window[_0x47d14b(0x145)](_0x47d14b(0x11b),function(_0x2ad968){const _0x2760e4=_0x47d14b,_0x470805=_0x2ad968['detail'];backgroundSprite&&app[_0x2760e4(0x128)]['removeChild'](backgroundSprite);const _0x2d4a4a=Texture[_0x2760e4(0x122)](_0x470805);backgroundSprite=new Sprite(_0x2d4a4a),backgroundSprite[_0x2760e4(0xf7)]=app['screen'][_0x2760e4(0xf7)],backgroundSprite['height']=app[_0x2760e4(0xf5)][_0x2760e4(0x110)],app[_0x2760e4(0x128)][_0x2760e4(0x133)](backgroundSprite,0x0);}),window[_0x47d14b(0x145)](_0x47d14b(0x103),function(_0xb1015d){const _0x2db4cc=_0x47d14b,_0x2a0484=_0xb1015d['detail'];console[_0x2db4cc(0x120)](_0x2db4cc(0x134),_0x2a0484),_0x2a0484[_0x2db4cc(0x146)](),console['log'](_0x2db4cc(0x11d),_0x2a0484),_0x2a0484[_0x2db4cc(0x145)](_0x2db4cc(0xfc),function(){const _0xc17b8b=_0x2db4cc;backgroundSprite&&app['stage'][_0xc17b8b(0x135)](backgroundSprite),console[_0xc17b8b(0x120)]('视频加载完成:',_0x2a0484);const _0x34ca7c=Texture[_0xc17b8b(0x122)](_0x2a0484);if(_0x34ca7c[_0xc17b8b(0x164)][_0xc17b8b(0x12a)][_0xc17b8b(0x162)][_0xc17b8b(0x10a)]=!0x0,!_0x34ca7c||_0x34ca7c['baseTexture'][_0xc17b8b(0x12d)]===!0x1){console['error'](_0xc17b8b(0x126));return;}console[_0xc17b8b(0x120)](_0xc17b8b(0x14c),_0x34ca7c),backgroundSprite=new Sprite(_0x34ca7c),backgroundSprite['preload']=_0xc17b8b(0x115),backgroundSprite[_0xc17b8b(0xf7)]=app['screen'][_0xc17b8b(0xf7)],backgroundSprite[_0xc17b8b(0x110)]=app['screen'][_0xc17b8b(0x110)],app[_0xc17b8b(0x128)][_0xc17b8b(0x133)](backgroundSprite,0x0),console[_0xc17b8b(0x120)](_0xc17b8b(0x13d),app[_0xc17b8b(0x128)][_0xc17b8b(0x163)]['length']),Ticker[_0xc17b8b(0xfa)][_0xc17b8b(0x15b)](()=>{const _0x10db09=_0xc17b8b;_0x34ca7c[_0x10db09(0x123)]();});}),_0x2a0484[_0x2db4cc(0x146)]();});}());const onResults=_0xa23df0=>{const _0x519b85=_0x54417c;drawResults(_0xa23df0[_0x519b85(0x165)][0x0]),animateLive2DModel(_0xa23df0[_0x519b85(0x165)][0x0]);},drawResults=_0x3f34c8=>{const _0x4202ef=_0x54417c;if(!guideCanvas||!videoElement||!_0x3f34c8)return;guideCanvas[_0x4202ef(0xf7)]=videoElement[_0x4202ef(0x107)],guideCanvas[_0x4202ef(0x110)]=videoElement[_0x4202ef(0x127)];let _0x46a7e3=guideCanvas[_0x4202ef(0x13b)]('2d');_0x46a7e3[_0x4202ef(0x153)](),_0x46a7e3[_0x4202ef(0x10d)](0x0,0x0,guideCanvas[_0x4202ef(0xf7)],guideCanvas['height']),drawConnectors(_0x46a7e3,_0x3f34c8,FACEMESH_TESSELATION,{'color':_0x4202ef(0xfb),'lineWidth':0x1}),_0x3f34c8&&_0x3f34c8[_0x4202ef(0xf4)]===0x1de&&drawLandmarks(_0x46a7e3,[_0x3f34c8[0x1d4],_0x3f34c8[0x1d4+0x5]],{'color':_0x4202ef(0x112),'lineWidth':0x2});},animateLive2DModel=_0x4c904a=>{const _0x520587=_0x54417c;if(!currentModel||!_0x4c904a)return;let _0x211209;if(_0x4c904a){_0x211209=Face[_0x520587(0x147)](_0x4c904a,{'runtime':_0x520587(0x167),'video':videoElement});const _0x1b1365=currentModel[_0x520587(0x104)][_0x520587(0x10e)],_0x482fd2=typeof _0x1b1365['getParameterValueById']==_0x520587(0xf2)&&typeof _0x1b1365[_0x520587(0xfe)]==_0x520587(0xf2);if(_0x482fd2){const _0x3575a3=[_0x520587(0x111),_0x520587(0x12e),_0x520587(0x109),_0x520587(0x15e),_0x520587(0x15d),_0x520587(0x11a),_0x520587(0x14d),_0x520587(0x10f),_0x520587(0xf9),_0x520587(0x158),_0x520587(0x166),'ParamMouthForm'];let _0x1a8ad3=!0x0;for(const _0x5bec48 of _0x3575a3)if(typeof _0x1b1365[_0x520587(0x142)](_0x5bec48)==_0x520587(0x15a)){_0x1a8ad3=!0x1;break;}_0x1a8ad3?rigFace(_0x211209,0.5):focusFace(_0x211209,_0x4c904a,0.5);}else focusFace(_0x211209,_0x4c904a,0.5);}},focusFace=_0x213055=>{const _0x361c71=_0x54417c;if(!currentModel||!_0x213055)return;const _0x3316a0=currentModel[_0x361c71(0x104)][_0x361c71(0x10e)],_0x5bc4f9=document[_0x361c71(0x10b)](_0x361c71(0xf6)),_0x5059d6=_0x5bc4f9[_0x361c71(0x13a)](),{degrees:_0x51152d}=_0x213055[_0x361c71(0x14f)],_0x134913=_0x5059d6[_0x361c71(0xf7)]/0x2,_0x239aa3=_0x5059d6['height']/0x2,_0x585c9a=0x5,_0x20de89=_0x51152d['y']/_0x585c9a*(_0x5059d6[_0x361c71(0xf7)]/0x2),_0x1f9bfd=-_0x51152d['x']/_0x585c9a*(_0x5059d6[_0x361c71(0x110)]/0x2),_0xcbf500=_0x134913+_0x20de89,_0x2f137e=_0x239aa3+_0x1f9bfd;currentModel[_0x361c71(0x118)](_0xcbf500,_0x2f137e),_0x3316a0[_0x361c71(0x149)](_0x361c71(0x143),lerp(_0x213055[_0x361c71(0x11f)]['y'],_0x3316a0[_0x361c71(0x155)](_0x361c71(0x143)),0.3)),currentModel['internalModel'][_0x361c71(0xf1)]['setEyeParams'](lerp(_0x213055['eye']['l'],currentModel[_0x361c71(0x104)]['eyeBlink']['eyeParamValue'],0.3));},rigFace=(_0x5b5a28,_0x5480f8=0.7)=>{const _0x319ba2=_0x54417c;if(!currentModel||!_0x5b5a28)return;const _0x2fb5a0=currentModel[_0x319ba2(0x104)][_0x319ba2(0x10e)];currentModel[_0x319ba2(0x104)][_0x319ba2(0x12c)][_0x319ba2(0x123)]=(..._0x5001e3)=>{const _0x437d52=_0x319ba2;currentModel[_0x437d52(0x104)]['eyeBlink']=void 0x0,_0x2fb5a0[_0x437d52(0xfe)](_0x437d52(0x111),lerp(_0x5b5a28[_0x437d52(0x15c)]['x'],_0x2fb5a0[_0x437d52(0x142)](_0x437d52(0x111)),_0x5480f8)),_0x2fb5a0['setParameterValueById'](_0x437d52(0x12e),lerp(_0x5b5a28[_0x437d52(0x15c)]['y'],_0x2fb5a0[_0x437d52(0x142)](_0x437d52(0x12e)),_0x5480f8)),_0x2fb5a0[_0x437d52(0xfe)]('ParamAngleX',lerp(_0x5b5a28[_0x437d52(0x14f)]['degrees']['y'],_0x2fb5a0[_0x437d52(0x142)](_0x437d52(0x109)),_0x5480f8)),_0x2fb5a0[_0x437d52(0xfe)](_0x437d52(0x15e),lerp(_0x5b5a28[_0x437d52(0x14f)][_0x437d52(0x114)]['x'],_0x2fb5a0[_0x437d52(0x142)]('ParamAngleY'),_0x5480f8)),_0x2fb5a0['setParameterValueById']('ParamAngleZ',lerp(_0x5b5a28[_0x437d52(0x14f)][_0x437d52(0x114)]['z'],_0x2fb5a0[_0x437d52(0x142)](_0x437d52(0x15d)),_0x5480f8));const _0x1fd30f=0.3;_0x2fb5a0['setParameterValueById'](_0x437d52(0x11a),lerp(_0x5b5a28[_0x437d52(0x14f)][_0x437d52(0x114)]['y']*_0x1fd30f,_0x2fb5a0['getParameterValueById'](_0x437d52(0x11a)),_0x5480f8)),_0x2fb5a0[_0x437d52(0xfe)](_0x437d52(0x14d),lerp(_0x5b5a28[_0x437d52(0x14f)][_0x437d52(0x114)]['x']*_0x1fd30f,_0x2fb5a0[_0x437d52(0x142)]('ParamBodyAngleY'),_0x5480f8)),_0x2fb5a0['setParameterValueById'](_0x437d52(0x10f),lerp(_0x5b5a28[_0x437d52(0x14f)][_0x437d52(0x114)]['z']*_0x1fd30f,_0x2fb5a0[_0x437d52(0x142)](_0x437d52(0x10f)),_0x5480f8));let _0x5c04dc=Kalidokit[_0x437d52(0x129)][_0x437d52(0x138)]({'l':lerp(_0x5b5a28['eye']['l'],_0x2fb5a0[_0x437d52(0x142)](_0x437d52(0xf9)),0.7),'r':lerp(_0x5b5a28['eye']['r'],_0x2fb5a0['getParameterValueById']('ParamEyeROpen'),0.7)},_0x5b5a28['head']['y'],{'enableWink':!0x0,'maxRot':0.5});_0x2fb5a0[_0x437d52(0xfe)](_0x437d52(0xf9),_0x5c04dc['l']),_0x2fb5a0[_0x437d52(0xfe)](_0x437d52(0x158),_0x5c04dc['r']),_0x2fb5a0[_0x437d52(0xfe)]('ParamMouthOpenY',lerp(_0x5b5a28[_0x437d52(0x11f)]['y'],_0x2fb5a0['getParameterValueById'](_0x437d52(0x166)),0.3)),_0x2fb5a0[_0x437d52(0xfe)]('ParamMouthForm',0.3+lerp(_0x5b5a28[_0x437d52(0x11f)]['x'],_0x2fb5a0[_0x437d52(0x142)](_0x437d52(0x119)),0.3));};},startCamera=()=>{const _0x1a1f49=_0x54417c,_0x522c23=new Camera(videoElement,{'onFrame':async()=>{await facemesh['send']({'image':videoElement});},'width':0x280,'height':0x1e0});_0x522c23[_0x1a1f49(0x151)]();};